<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–û—Å—Ç—Ä–æ–≤ ‚Äî –∫–∞—Ä—Ç–∞ (–ø–∞–Ω–µ–ª—å –∑—É–º–∞ –≤–Ω–µ –∫–∞—Ä—Ç—ã)</title>

<link rel="preload" as="image" href="1.jpg">
<link rel="preload" as="image" href="2.jpg">
<link rel="preload" as="image" href="3.jpg">
<link rel="preload" as="image" href="4.jpg">
<link rel="preload" as="image" href="5.jpg">
<link rel="preload" as="image" href="6.jpg">
<link rel="preload" as="image" href="7.jpg">
<link rel="preload" as="image" href="8.jpg">

<style>
  html,body{height:100%}
  body{margin:0;background:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

  .wrap{width:100%;max-width:100%;margin:0 auto;display:flex;justify-content:center}
  .card{position:relative;background:#fff;width:100%} /* –≤–∞–∂–Ω–æ–µ: —à–∏—Ä–∏–Ω–∞ –≤–æ –≤—Å—é –∫–æ–ª–æ–Ω–∫—É */

  /* –ø–∞–Ω–µ–ª—å –∑—É–º–∞ ‚Äî –í–ù–ï –∫–∞—Ä—Ç—ã, –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
  .zoombar{
    display:flex;justify-content:center;gap:8px;align-items:center;
    width:100%;padding:6px 0;margin:4px 0 8px;
    background:transparent
  }
  .zoombar .stat{min-width:52px;text-align:center;font-variant-numeric:tabular-nums;font-weight:700}
  .zoombar button{
    appearance:none;border:0;border-radius:8px;padding:6px 10px;
    background:#0ea5e9;color:#fff;font-weight:800;cursor:pointer;line-height:1
  }

  /* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã: –µ—Å–ª–∏ –∫–∞—Ä—Ç–∞ –±–æ–ª—å—à–µ –≤–∏–¥–∏–º–æ–π –≤—ã—Å–æ—Ç—ã ‚Äî –ø–æ—è–≤–∏—Ç—Å—è —Å–∫—Ä–æ–ª–ª */
  .mapBox{position:relative;overflow:auto}

  /* svg ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ width/height –∑–∞–¥–∞—ë—Ç JS (–±–µ–∑ transform) */
  .map{display:block}

  /* –∑–æ–Ω—ã (–±–µ–∑ —Å–∏–Ω–µ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è) */
  .hotspot{cursor:pointer;fill:transparent;pointer-events:all;outline:none;-webkit-tap-highlight-color:transparent;user-select:none}
  .hotspot[data-type="link"]:focus,.hotspot[data-type="link"]:focus-visible{outline:none}

  /* –º–æ–¥–∞–ª–∫–∞ */
  .modal[hidden]{display:none}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:grid;place-items:center;z-index:9999}
  .modal__box{background:#fff;max-width:560px;margin:16px;padding:24px;border-radius:16px;text-align:center}
  .btn{appearance:none;border:0;border-radius:12px;padding:10px 16px;font-weight:700;cursor:pointer;background:#0ea5e9;color:#fff}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <!-- –ü–ê–ù–ï–õ–¨ –ó–£–ú–ê (–≤–Ω–µ –∫–∞—Ä—Ç—ã) -->
    <div class="zoombar">
      <button id="zmMinus" aria-label="–£–º–µ–Ω—å—à–∏—Ç—å">‚àí</button>
      <span class="stat" id="zmStat">100%</span>
      <button id="zmPlus" aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
    </div>

    <!-- –ö–ê–†–¢–ê -->
    <div class="mapBox" id="mapBox">
      <!-- viewBox = 768√ó1152 -->
      <svg id="svg" class="map" viewBox="0 0 768 1152" preserveAspectRatio="xMidYMid meet">
        <image id="mapImg" href="1.jpg" width="768" height="1152"/>
        <g id="zonesLayer"></g>
      </svg>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ -->
<div id="modal" class="modal" hidden>
  <div class="modal__box">
    <div id="modalText" style="margin-bottom:16px;font-size:18px;line-height:1.4">–°–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶</div>
    <button id="modalClose" class="btn">–ü–æ–Ω—è—Ç–Ω–æ</button>
  </div>
</div>

<script>
/* —Å–æ–æ–±—â–µ–Ω–∏—è */
const MSG_RED = ['üî• –õ–∞–≥–µ—Ä—å –ö—Ä–∞—Å–Ω—ã—Ö –Ω–∞ —Å–≤—è–∑–∏! –°–æ–±–∏—Ä–∞–µ–º—Å—è –∏ –∂–∂—ë–º —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ —à–∞–≥–∏.','–ü–ª–∞–º—è —Ä–∞–∑–≥–æ—Ä–µ–ª–æ—Å—å ‚Äî –ø–æ—Ä–∞ –≤ –ë—É—Ö—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.','–ù–∞—à –¥–µ–≤–∏–∑: ¬´–ú–∞–ª–æ —Å–ª–æ–≤ ‚Äî –±–æ–ª—å—à–µ —à–∞–≥–æ–≤¬ª. –í –±–æ–π!','–ì–æ—Ä—è—á–∏–π –∫–≤–µ—Å—Ç –¥–Ω—è: 10 –º–∏–Ω—É—Ç —Ç–µ–º–ø–æ–≤–æ–π —Ö–æ–¥—å–±—ã + –≤–æ–¥–∞. –°–¥–µ–ª–∞–Ω–æ?','–¢–æ–ø–∏–º –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—é: 3‚Ä¶2‚Ä¶1 ‚Äî –ø–æ—à–ª–∏!','–°–µ–≥–æ–¥–Ω—è –æ—Ö–æ—Ç–∞ –∑–∞ –æ—á–∫–∞–º–∏: –±–µ—Ä—ë–º –ª–∏–¥–µ—Ä—Å—Ç–≤–æ?'];
const MSG_YELLOW = ['üåû –õ–∞–≥–µ—Ä—å –ñ—ë–ª—Ç—ã—Ö —Å–≤–µ—Ç–∏—Ç —è—Ä—á–µ! –í–∫–ª—é—á–∞–µ–º —ç–Ω–µ—Ä–≥–∏—é –∏ —à–∞–≥–∞–µ–º.','–°–æ–ª–Ω—ã—à–∫–æ –∑–æ–≤—ë—Ç: ¬´+1000 —à–∞–≥–æ–≤ –¥–æ –æ–±–µ–¥–∞¬ª. –£—Å–ø–µ–µ–º?','–ù–∞—à –¥–µ–≤–∏–∑: ¬´–õ–µ–≥–∫–æ, —Å–≤–µ—Ç–ª–æ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–Ω–æ¬ª. –ü–æ–µ—Ö–∞–ª–∏!','–î–µ–Ω—å –ª—ë–≥–∫–æ—Å—Ç–∏: 15 –º–∏–Ω—É—Ç —à–∞–≥–æ–≤ + —Ä–∞—Å—Ç—è–∂–∫–∞.','–£–ª—ã–±–∫–∞ + –º—É–∑—ã–∫–∞ = –±—ã—Å—Ç—Ä—ã–µ –∫–∞–ª–æ—Ä–∏–∏. –í–ø–µ—Ä—ë–¥!','–î–µ—Ä–∂–∏–º –ª–∏–¥–µ—Ä—Å—Ç–≤–æ! –û—Å—Ç–∞–≤–∏–º –ö—Ä–∞—Å–Ω—ã—Ö –ø–æ–∑–∞–¥–∏?'];
const pick = a => a[Math.floor(Math.random()*a.length)];

/* –∑–æ–Ω—ã + —Å—Å—ã–ª–∫–∏ */
const zones = [
  {id:'food_cliff',   name:'–°–∫–∞–ª–∞ –ø—Ä–æ–ø–∏—Ç–∞–Ω–∏—è', cx:384, cy:160, r:137, type:'link', link:'https://my.walk-walk.ru/teach/control/stream/view/id/934789818', image:'8.jpg'},
  {id:'luck_plateau', name:'–ü–ª–∞—Ç–æ –∞–∑–∞—Ä—Ç–∞',     cx:621, cy:373, r:146, type:'link', link:'https://my.walk-walk.ru/teach/control/stream/view/id/934789823', image:'7.jpg'},
  {id:'mind_mouth',   name:'–£—Å—Ç—å–µ —Ä–∞–∑—É–º–∞',     cx:423, cy:369, r: 68, type:'link', link:'https://my.walk-walk.ru/teach/control/stream/view/id/934789821', image:'6.jpg'},
  {id:'workout_bay',  name:'–ë—É—Ö—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫', cx:151, cy:491, r:112, type:'link', link:'https://my.walk-walk.ru/teach/control/stream/view/id/934789815', image:'5.jpg'},
  {id:'tribe_council',name:'–°–æ–≤–µ—Ç –ø–ª–µ–º–µ–Ω–∏',    cx:384, cy:588, r: 98, type:'link', link:'https://my.walk-walk.ru/teach/control/stream/view/id/934789822', image:'4.jpg'},
  {id:'inspire_forest',name:'–õ–µ—Å –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è', cx:625, cy:629, r:117, type:'link', link:'https://my.walk-walk.ru/teach/control/stream/view/id/934789826', image:'3.jpg'},
  {id:'arrival',      name:'–ó–æ–Ω–∞ –ø—Ä–∏–±—ã—Ç–∏—è',    cx:165, cy:835, r: 69, type:'link', link:'https://my.walk-walk.ru/teach/control/stream/view/id/934789820', image:'2.jpg'},
  {id:'camp_red',     name:'–õ–∞–≥–µ—Ä—å –∫—Ä–∞—Å–Ω—ã—Ö',   cx:187, cy:694, r: 95, type:'message', image:'1.jpg'},
  {id:'camp_yellow',  name:'–õ–∞–≥–µ—Ä—å –∂—ë–ª—Ç—ã—Ö',    cx:565, cy:850, r: 95, type:'message', image:'1.jpg'}
];

/* –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç */
['1.jpg','2.jpg','3.jpg','4.jpg','5.jpg','6.jpg','7.jpg','8.jpg'].forEach(s=>{const i=new Image(); i.src=s;});

const svg     = document.getElementById('svg');
const layer   = document.getElementById('zonesLayer');
const mapImg  = document.getElementById('mapImg');
const mapBox  = document.getElementById('mapBox');
const modal   = document.getElementById('modal');
const modalText = document.getElementById('modalText');
const modalClose= document.getElementById('modalClose');
const zmMinus = document.getElementById('zmMinus');
const zmPlus  = document.getElementById('zmPlus');
const zmStat  = document.getElementById('zmStat');

/* –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –±–∞–∑–∞ + –∑—É–º (—á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–µ width/height) */
const RATIO = 1152/768; // h/w
const IS_DESKTOP = window.matchMedia('(pointer:fine) and (min-width:1024px)').matches;

let baseW = 600;
let baseH = Math.round(baseW * RATIO);
let scale = 1.0;                        // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –º–∞—Å—à—Ç–∞–±
const MIN_SCALE = 0.9, MAX_SCALE = 2.2, STEP = 0.1;

function fitBaseSize(){
  const container = document.querySelector('.wrap') || mapBox.parentElement || document.body;
  const cw = container.getBoundingClientRect().width;

  const topY = mapBox.getBoundingClientRect().top;
  const availH = Math.max(240, window.innerHeight - topY - 6);

  // –¥–µ—Å–∫—Ç–æ–ø ‚Äî –≤–æ –≤—Å—é —à–∏—Ä–∏–Ω—É –∫–æ–ª–æ–Ω–∫–∏; –º–æ–±–∏–ª—å–Ω—ã–µ ‚Äî –Ω–µ –≤—ã—à–µ –æ–∫–Ω–∞
  if (IS_DESKTOP){
    baseW = Math.max(420, cw);
  }else{
    baseW = Math.max(300, Math.min(cw, Math.floor(availH / RATIO)));
  }
  baseH = Math.round(baseW * RATIO);
  applySize();
}

function applySize(){
  const w = Math.round(baseW * scale);
  const h = Math.round(baseH * scale);
  svg.style.width  = w + 'px';
  svg.style.height = h + 'px';

  const topY = mapBox.getBoundingClientRect().top;
  const availH = Math.max(240, window.innerHeight - topY - 6);
  mapBox.style.maxHeight = Math.floor(availH) + 'px';
  mapBox.style.overflow  = (h > availH) ? 'auto' : 'visible';

  zmStat.textContent = Math.round(scale*100) + '%';
}

function setScale(next){
  scale = Math.min(MAX_SCALE, Math.max(MIN_SCALE, next));
  applySize();
}

/* —Ä–µ—Å–∞–π–∑/—Å–∫—Ä–æ–ª–ª */
const ro = new ResizeObserver(fitBaseSize);
ro.observe(document.querySelector('.wrap') || mapBox.parentElement || document.body);
window.addEventListener('resize', fitBaseSize, {passive:true});
window.addEventListener('scroll', fitBaseSize, {passive:true});
window.addEventListener('orientationchange', fitBaseSize);
document.addEventListener('DOMContentLoaded', fitBaseSize);
setTimeout(fitBaseSize, 60);

/* –∫–Ω–æ–ø–∫–∏ –∑—É–º–∞ */
zmMinus.addEventListener('click', ()=> setScale(scale - STEP));
zmPlus .addEventListener('click', ()=> setScale(scale + STEP));

/* —Ö–æ–≤–µ—Ä/–∫–ª–∏–∫ –ø–æ –∑–æ–Ω–∞–º */
let hoverId=null, pressId=null;

zones.forEach(z=>{
  const c=document.createElementNS('http://www.w3.org/2000/svg','circle');
  c.classList.add('hotspot');
  c.dataset.id=z.id; c.dataset.type=z.type;
  c.setAttribute('cx',z.cx); c.setAttribute('cy',z.cy); c.setAttribute('r',z.r);
  if(z.type==='message') c.setAttribute('tabindex','0');
  layer.appendChild(c);

  c.addEventListener('pointerenter',()=>{ hoverId=z.id; mapImg.setAttribute('href', z.image||'1.jpg'); });
  c.addEventListener('pointerleave',()=>{ if(hoverId===z.id && !pressId){ hoverId=null; mapImg.setAttribute('href','1.jpg'); }});
  c.addEventListener('focus',()=>{ if(z.type==='message'){ hoverId=z.id; mapImg.setAttribute('href', z.image||'1.jpg'); }});
  c.addEventListener('blur', ()=>{ if(hoverId===z.id && !pressId){ hoverId=null; mapImg.setAttribute('href','1.jpg'); }});

  c.addEventListener('pointerdown',e=>{ pressId=z.id; mapImg.setAttribute('href', z.image||'1.jpg'); if(z.type==='link') c.blur?.(); e.preventDefault(); }, {passive:false});

  c.addEventListener('pointerup',()=>{
    const stillHover=(hoverId===z.id); pressId=null;
    if(z.type==='message'){
      const msg = z.id==='camp_red'?pick(MSG_RED): z.id==='camp_yellow'?pick(MSG_YELLOW):(z.message||'–°–æ–æ–±—â–µ–Ω–∏–µ');
      modalText.textContent=msg; modal.hidden=false; return;
    }
    if(z.type==='link' && z.link && z.link!=='#'){
      const win=window.open(z.link,'_blank'); if(win) win.opener=null;
      if(!stillHover) mapImg.setAttribute('href','1.jpg'); return;
    }
    if(!stillHover) mapImg.setAttribute('href','1.jpg');
  });
  c.addEventListener('pointercancel',()=>{ pressId=null; if(!hoverId) mapImg.setAttribute('href','1.jpg'); });
});

svg.addEventListener('pointerleave',()=>{ hoverId=null; pressId=null; mapImg.setAttribute('href','1.jpg'); });

/* –º–æ–¥–∞–ª–∫–∞ */
modalClose.addEventListener('click',()=>{ modal.hidden=true; mapImg.setAttribute('href','1.jpg'); });
modal.addEventListener('click',(e)=>{ if(e.target===modal){ modal.hidden=true; mapImg.setAttribute('href','1.jpg'); }});
document.addEventListener('keydown',(e)=>{ if(e.key==='Escape' && !modal.hidden){ modal.hidden=true; mapImg.setAttribute('href','1.jpg'); }});
</script>
</body>
</html>
